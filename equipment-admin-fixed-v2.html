<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>裝備管理系統</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // 圖標組件
        const Plus = ({size = 24}) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
        );

        const Minus = ({size = 24}) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
        );

        const Trash2 = ({size = 24}) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
        );

        const Search = ({size = 24}) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
            </svg>
        );

        // 本地存儲
        const storage = {
            get: (key) => {
                const value = localStorage.getItem(key);
                return value ? { key, value } : null;
            },
            set: (key, value) => {
                localStorage.setItem(key, value);
                return { key, value };
            }
        };

        const App = () => {
            const [items, setItems] = useState([]);
            const [isAdmin, setIsAdmin] = useState(null);
            const [password, setPassword] = useState('');
            const [searchTerm, setSearchTerm] = useState('');
            const [showAddModal, setShowAddModal] = useState(false);
            const [newItem, setNewItem] = useState({
                name: '',
                mainCategory: '裝備',
                subCategory1: '空白裝備',
                subCategory2: '衣服',
                quantity: 1
            });

            // 分類結構
            const categoryStructure = {
                '裝備': {
                    '空白裝備': ['衣服', '武器'],
                    '附魔裝': ['衣服', '武器'],
                    '外觀': ['衣服', '武器']
                },
                '王石': {
                    '王石': ['追加王石', '戒指王石', '衣服王石', '武器王石', '通用王石']
                }
            };

            // 加載數據
            useEffect(() => {
                const savedItems = storage.get('equipment-items');
                if (savedItems && savedItems.value) {
                    setItems(JSON.parse(savedItems.value));
                }
                
                const savedAdmin = localStorage.getItem('isAdmin');
                if (savedAdmin === 'true') {
                    setIsAdmin('admin');
                }
            }, []);

            // 保存數據
            const saveItems = (itemsToSave) => {
                storage.set('equipment-items', JSON.stringify(itemsToSave));
                setItems([...itemsToSave]);
            };

            // 處理登入
            const handleLogin = (e) => {
                e.preventDefault();
                if (password === 'toram123') {
                    localStorage.setItem('isAdmin', 'true');
                    setIsAdmin('admin');
                } else {
                    alert('密碼錯誤！');
                }
            };

            // 處理登出
            const handleLogout = () => {
                localStorage.removeItem('isAdmin');
                setIsAdmin(null);
                setPassword('');
            };

            // 添加新物品
            const addItem = (e) => {
                e.preventDefault();
                if (!newItem.name.trim()) return;
                
                const item = {
                    id: Date.now(),
                    ...newItem,
                    quantity: parseInt(newItem.quantity) || 0
                };
                
                const updatedItems = [...items, item];
                saveItems(updatedItems);
                
                // 重置表單
                setNewItem({
                    name: '',
                    mainCategory: '裝備',
                    subCategory1: '空白裝備',
                    subCategory2: '衣服',
                    quantity: 1
                });
                
                setShowAddModal(false);
            };

            // 更新數量
            const updateQuantity = (id, change) => {
                const updated = items.map(item => 
                    item.id === id 
                        ? { ...item, quantity: Math.max(0, item.quantity + change) } 
                        : item
                );
                saveItems(updated);
            };

            // 刪除物品
            const deleteItem = (id) => {
                if (window.confirm('確定要刪除此物品嗎？')) {
                    const updated = items.filter(item => item.id !== id);
                    saveItems(updated);
                }
            };

            // 登入頁面
            if (isAdmin === null) {
                return (
                    <div className="min-h-screen flex items-center justify-center bg-gray-900 p-4">
                        <div className="bg-gray-800 p-8 rounded-lg shadow-xl max-w-md w-full">
                            <h1 className="text-2xl font-bold mb-6 text-center">管理員登入</h1>
                            <form onSubmit={handleLogin}>
                                <div className="mb-4">
                                    <label className="block text-gray-300 mb-2">密碼</label>
                                    <input
                                        type="password"
                                        value={password}
                                        onChange={(e) => setPassword(e.target.value)}
                                        className="w-full px-4 py-2 bg-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        required
                                    />
                                </div>
                                <button
                                    type="submit"
                                    className="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded transition"
                                >
                                    登入
                                </button>
                            </form>
                        </div>
                    </div>
                );
            }

            // 主界面
            return (
                <div className="min-h-screen bg-gray-900 p-4">
                    <div className="max-w-6xl mx-auto">
                        <div className="flex justify-between items-center mb-6">
                            <h1 className="text-2xl font-bold">裝備管理系統</h1>
                            <button
                                onClick={handleLogout}
                                className="bg-red-600 hover:bg-red-700 text-white py-1 px-3 rounded"
                            >
                                登出
                            </button>
                        </div>

                        <div className="mb-6">
                            <div className="flex justify-between items-center">
                                <div className="relative w-64">
                                    <input
                                        type="text"
                                        placeholder="搜尋物品..."
                                        value={searchTerm}
                                        onChange={(e) => setSearchTerm(e.target.value)}
                                        className="w-full pl-10 pr-4 py-2 bg-gray-800 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    />
                                    <div className="absolute left-3 top-2.5 text-gray-400">
                                        <Search size={18} />
                                    </div>
                                </div>
                                <button
                                    onClick={() => setShowAddModal(true)}
                                    className="bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg flex items-center gap-2"
                                >
                                    <Plus size={18} />
                                    新增物品
                                </button>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            {items
                                .filter(item => 
                                    item.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                    item.mainCategory.includes(searchTerm) ||
                                    item.subCategory1.includes(searchTerm) ||
                                    item.subCategory2.includes(searchTerm)
                                )
                                .map(item => (
                                    <div key={item.id} className="bg-gray-800 p-4 rounded-lg shadow">
                                        <div className="flex justify-between items-start">
                                            <div>
                                                <h3 className="font-bold text-lg">{item.name}</h3>
                                                <p className="text-gray-400 text-sm">
                                                    {item.mainCategory} > {item.subCategory1} > {item.subCategory2}
                                                </p>
                                            </div>
                                            <div className="flex items-center gap-2">
                                                <button
                                                    onClick={() => updateQuantity(item.id, -1)}
                                                    className="p-1 hover:bg-gray-700 rounded"
                                                >
                                                    <Minus size={16} />
                                                </button>
                                                <span className="w-8 text-center">{item.quantity}</span>
                                                <button
                                                    onClick={() => updateQuantity(item.id, 1)}
                                                    className="p-1 hover:bg-gray-700 rounded"
                                                >
                                                    <Plus size={16} />
                                                </button>
                                                <button
                                                    onClick={() => deleteItem(item.id)}
                                                    className="p-1 text-red-400 hover:bg-red-900/50 rounded"
                                                >
                                                    <Trash2 size={16} />
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                        </div>
                    </div>

                    {/* 新增物品模態框 */}
                    {showAddModal && (
                        <div className="fixed inset-0 bg-black/70 flex items-center justify-center p-4 z-50">
                            <div className="bg-gray-800 p-6 rounded-lg shadow-xl max-w-md w-full">
                                <h2 className="text-xl font-bold mb-4">新增物品</h2>
                                <form onSubmit={addItem}>
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-gray-300 mb-1">物品名稱</label>
                                            <input
                                                type="text"
                                                value={newItem.name}
                                                onChange={(e) => setNewItem({...newItem, name: e.target.value})}
                                                className="w-full px-4 py-2 bg-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                required
                                            />
                                        </div>
                                        
                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-gray-300 mb-1">主分類</label>
                                                <select
                                                    value={newItem.mainCategory}
                                                    onChange={(e) => {
                                                        const firstSub = Object.keys(categoryStructure[e.target.value] || {})[0];
                                                        const firstSubSub = categoryStructure[e.target.value]?.[firstSub]?.[0] || '';
                                                        setNewItem({
                                                            ...newItem,
                                                            mainCategory: e.target.value,
                                                            subCategory1: firstSub,
                                                            subCategory2: firstSubSub
                                                        });
                                                    }}
                                                    className="w-full px-4 py-2 bg-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                >
                                                    {Object.keys(categoryStructure).map(cat => (
                                                        <option key={cat} value={cat}>{cat}</option>
                                                    ))}
                                                </select>
                                            </div>
                                            
                                            <div>
                                                <label className="block text-gray-300 mb-1">次分類1</label>
                                                <select
                                                    value={newItem.subCategory1}
                                                    onChange={(e) => {
                                                        const firstSubSub = categoryStructure[newItem.mainCategory]?.[e.target.value]?.[0] || '';
                                                        setNewItem({
                                                            ...newItem,
                                                            subCategory1: e.target.value,
                                                            subCategory2: firstSubSub
                                                        });
                                                    }}
                                                    className="w-full px-4 py-2 bg-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                >
                                                    {newItem.mainCategory && 
                                                        Object.keys(categoryStructure[newItem.mainCategory] || {}).map(sub => (
                                                            <option key={sub} value={sub}>{sub}</option>
                                                        ))
                                                    }
                                                </select>
                                            </div>
                                            
                                            <div>
                                                <label className="block text-gray-300 mb-1">次分類2</label>
                                                <select
                                                    value={newItem.subCategory2}
                                                    onChange={(e) => setNewItem({...newItem, subCategory2: e.target.value})}
                                                    className="w-full px-4 py-2 bg-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                >
                                                    {newItem.mainCategory && 
                                                        newItem.subCategory1 && 
                                                        categoryStructure[newItem.mainCategory]?.[newItem.subCategory1]?.map(sub => (
                                                            <option key={sub} value={sub}>{sub}</option>
                                                        ))
                                                    }
                                                </select>
                                            </div>
                                            
                                            <div>
                                                <label className="block text-gray-300 mb-1">數量</label>
                                                <input
                                                    type="number"
                                                    min="0"
                                                    value={newItem.quantity}
                                                    onChange={(e) => setNewItem({...newItem, quantity: e.target.value})}
                                                    className="w-full px-4 py-2 bg-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                    required
                                                />
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div className="mt-6 flex justify-end space-x-3">
                                        <button
                                            type="button"
                                            onClick={() => setShowAddModal(false)}
                                            className="px-4 py-2 bg-gray-600 hover:bg-gray-500 rounded"
                                        >
                                            取消
                                        </button>
                                        <button
                                            type="submit"
                                            className="px-4 py-2 bg-blue-600 hover:bg-blue-500 rounded"
                                        >
                                            確認新增
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // 初始化應用
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
